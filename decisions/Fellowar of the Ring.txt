# Imladris Decisons: {
#	Pre-Fellowship
#	Council of Elrond 
#	War of the Ring }

# ring_controller mapping:
#	0 = Bilbo
#	1 = Frodo
#	2 = Fellowship
#	3 = Other
#	4 = Gollum

# Pre-Fellowship
political_decisions = {
	bilbos_111_birthday = {
		potential = {
			tag = FOR
			year = 3001
			NOT = { has_global_flag = bilbos_111_birthday_party }
		}
		
		allow = {
			NOT = { year = 3002 }
			month = 8
		}
		
		effect = {
			1040 = {
				owner = {
					country_event = {
						id = 50200
						days = 20
					}
				}
			}
			set_global_flag = bilbos_111_birthday_party
		}
	}
	
	search_for_the_ring_hobbiton = {
		picture = "bilbo_party"
		potential = {
			owns = 1040
			good_evil_alignment = evil_alignment
			has_global_flag = bilbos_111_birthday_party
			FOR = { check_variable = { which = ring_controller value = 0.9 } } # Frodo
			FOR = { NOT = { check_variable = { which = ring_controller value = 1.1 } } } # Frodo
			NOT = { has_global_flag = hobbiton_search_for_ring }
			NOT = { has_global_flag = frodo_fled_shire }
			NOT = { has_global_flag = findings_of_gandalf }
		}
		
		allow = {
			good_evil_alignment = evil_alignment
		}
		
		effect = {
			badboy = 3
			# Railroading ensures that Frodo flees the Shire
			random_owned = {
				limit = {
					owner = { has_global_flag = railroading_enabled }
				}
				owner = { country_event = { id = 50202 days = 10 } }
			}
			
			# No Railroading, 1% chance of finding the Ring
			random_owned = {
				limit = {
					owner = { NOT = { has_global_flag = railroading_enabled } }
				}
				owner = {
					random_list = {
						99 = { country_event = { id = 50202 days = 10 } }
						1 = { country_event = { id = 50203 days = 10 } }
					}
				}
			}
			
			set_global_flag = hobbiton_search_for_ring
		}
	}
	
	release_the_nine = {
		potential = {
			tag = MOR
			NOT = { has_country_modifier = ring_hunters }
			good_evil_alignment = evil_alignment
			has_global_flag = findings_of_gandalf
			nationalvalue = sauron
			FOR = { check_variable = { which = ring_controller value = 0.9 } } # Frodo
			FOR = { NOT = { check_variable = { which = ring_controller value = 1.1 } } } # Frodo
			NOT = { has_global_flag = nine_hunting_frodo }
		}
		
		allow = {
			good_evil_alignment = evil_alignment
			nationalvalue = sauron
		}
		
		effect = {
			add_country_modifier = { name = ring_hunters duration = -1 } # Removed when Frodo reaches the council capital

			# No Railroading, 0.25% chance of finding the Ring
			random_owned = {
				limit = {
					owner = { NOT = { has_global_flag = railroading_enabled } }
				}
				owner = {
					random_list = {
						399 = {}
						1 = { country_event = 50203 }
					}
				}
			}
			set_global_flag = nine_hunting_frodo 
		}
	}
	
	send_ring_hunters = {
		potential = {
			NOT = { tag = MOR }
			NOT = { has_country_modifier = ring_hunters }
			good_evil_alignment = evil_alignment
			has_global_flag = findings_of_gandalf
			FOR = { check_variable = { which = ring_controller value = 0.9 } } # Frodo
			FOR = { NOT = { check_variable = { which = ring_controller value = 1.1 } } } # Frodo
			NOT = { has_global_flag = frodo_fled_shire }
			NOT = { owns = 1040 }
		}
		
		allow = {
			good_evil_alignment = evil_alignment
			OR = {
				is_greater_power = yes
				is_secondary_power = yes
			}
		}
		
		effect = {
			add_country_modifier = { name = ring_hunters duration = -1 } # Removed when Frodo flees the shire
			
			# No Railroading, 0.25% chance of finding the Ring
			random_owned = {
				limit = {
					owner = { NOT = { has_global_flag = railroading_enabled } }
				}
				owner = {
					random_list = {
						399 = {}
						1 = { country_event = 50203 }
					}
				}
			}
			
		}
	}
}

# Council of Elrond
political_decisions = {
	# Special council_of_capital for Imladris
	council_of_elrond = {
		potential = {
			FOR = { check_variable = { which = ring_controller value = 0.9 } } # Frodo
			FOR = { NOT = { check_variable = { which = ring_controller value = 1.1 } } } # Frodo
			NOT = { good_evil_alignment = evil_alignment }
			nationalvalue = elrond
			tag = IML
			OR = {
				has_country_flag = frodo_chose_us
				FOR = {
					any_neighbor_country = {
						NOT = { has_country_flag = frodo_chose_us }
						good_evil_alignment = good_alignment
					}
				}
			}
			NOT = { has_global_flag = the_council_of_elrond }	
		}
		
		allow = {
			OR = {
				diplomacy_5 = 1
				year = 3010
			}
			OR = {
				has_country_flag = frodo_chose_us
				FOR = {
					any_neighbor_country = {
						NOT = { has_country_flag = frodo_chose_us }
						good_evil_alignment = good_alignment
					}
				}
			}
			NOT = { good_evil_alignment = evil_alignment }
		}
		
		effect = {
			set_global_flag = the_council_of_elrond
			set_country_flag = the_council_of_elrond_host
			any_country = {
				limit = {
					good_evil_alignment = good_alignment
					NOT = { tag = IML }
					is_vassal = no
					OR = {
						is_greater_power = yes
						is_secondary_power = yes
					}
					exists = yes
				}
				country_event = 50250
			}
			country_event = {
				id = 50253
				days = 3
			}
		}
	}
	
	council_of_capital = {
		picture = "council_of_elrond"
		potential = {
			FOR = { check_variable = { which = ring_controller value = 0.9 } } # Frodo
			FOR = { NOT = { check_variable = { which = ring_controller value = 1.1 } } } # Frodo
			NOT = { good_evil_alignment = evil_alignment }
			NOT = {
				nationalvalue = elrond
				tag = IML
			}
			OR = {
				has_country_flag = frodo_chose_us
				FOR = {
					any_neighbor_country = {
						NOT = { has_country_flag = frodo_chose_us }
						good_evil_alignment = good_alignment
					}
				}
			}
			NOT = { has_global_flag = the_council_of_elrond }	
		}
		
		allow = {
			OR = {
				diplomacy_5 = 1
				year = 3010
			}
			OR = {
				has_country_flag = frodo_chose_us
				FOR = {
					any_neighbor_country = {
						NOT = { has_country_flag = frodo_chose_us }
						good_evil_alignment = good_alignment
					}
				}
			}
			NOT = { good_evil_alignment = evil_alignment }
		}
		
		effect = {
			set_global_flag = the_council_of_elrond
			set_country_flag = the_council_of_elrond_host
			any_country = {
				limit = {
					good_evil_alignment = good_alignment
					NOT = { tag = IML }
					is_vassal = no
					OR = {
						is_greater_power = yes
						is_secondary_power = yes
					}
					exists = yes
				}
				country_event = 50250
			}
			country_event = {
				id = 50253
				days = 3
			}
		}
	}
}

# War of the Ring
political_decisions = {
	war_of_the_ring_leader_selection = {
		picture = "war_of_the_ring"
		
		potential = {
			tag = FOR
			NOT = { check_variable = { which = ring_controller value = 1.9 } } # Frodo
			check_variable = { which = ring_controller value = 2.1 } # Frodo
			NOT = { has_country_modifier = wotr_countdown }
			NOT = { has_global_flag = wotr_leaders_chosen }
		}
		
		allow = {}
		
		effect = {
			random_country = {
				limit = {
					OR = {
						AND = {
							OR = {
								tag = GON
								AND = {
									is_greater_power = yes
									ai = no
								}
							}
							good_evil_alignment = good_alignment
						}
						AND = {
							NOT = { GON = { good_evil_alignment = good_alignment } }
							good_evil_alignment = good_alignment
							is_greater_power = yes
						}
						AND = {
							NOT = { GON = { good_evil_alignment = good_alignment } }
							NOT = { any_greater_power = { good_evil_alignment = good_alignment } }
							good_evil_alignment = good_alignment
						}
					}
				}
				set_country_flag = good_leader
				country_event = 50304
				country_event = { id = 50306 days = 1 }
			}
			
			random_country = {
				limit = {
					OR = {
						AND = {
							OR = {
								tag = MOR
								AND = {
									is_greater_power = yes
									ai = no
								}
							}
							good_evil_alignment = evil_alignment
						}
						AND = {
							NOT = { MOR = { good_evil_alignment = evil_alignment } }
							good_evil_alignment = evil_alignment
							is_greater_power = yes
						}
						AND = {
							NOT = { MOR = { good_evil_alignment = evil_alignment } }
							NOT = { any_greater_power = { good_evil_alignment = evil_alignment } }
							good_evil_alignment = evil_alignment
						}
					}
				}
				set_country_flag = evil_leader
				country_event = 50305
			}
			
			set_global_flag = wotr_leaders_chosen
		}
	}
	
	war_of_the_ring_ensure_realms_fight = {
		picture = "war_of_the_ring"
		
		potential = {
			tag = FOR
			any_neighbor_country = { war = no }
			NOT = { has_country_flag = get_realms_to_fight }
			any_neighbor_country = { has_country_flag = good_leader }
			any_neighbor_country = { has_country_flag = evil_leader }
		}
		
		allow = {}
		
		effect = {
			any_neighbor_country = {
				limit = {
					war = no
					good_evil_alignment = good_alignment
				}
				country_event = 50308
			}
			
			any_neighbor_country = {
				limit = {
					war = no
					good_evil_alignment = evil_alignment
				}
				country_event = 50309
			}
			
			set_country_flag = get_realms_to_fight
		}
	}
	
	war_of_the_ring_ensure_realms_fight_2 = {
		picture = "war_of_the_ring"
		
		potential = {
			tag = FOR
			has_country_flag = get_realms_to_fight
		}
		
		allow = {}
		
		effect = {
			any_neighbor_country = {
				limit = {
					has_country_flag = good_leader
					has_country_flag = good_needs_to_fight
				}
				clr_country_flag = good_needs_to_fight
				country_event = 50310
			}
			
			any_neighbor_country = {
				limit = {
					has_country_flag = evil_leader
					has_country_flag = evil_needs_to_fight
				}
				clr_country_flag = evil_needs_to_fight
				country_event = 50310
			}
			
			clr_country_flag = get_realms_to_fight
		}
	}
}